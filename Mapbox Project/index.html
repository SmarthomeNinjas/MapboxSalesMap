<!DOCTYPE html>
<html lang='en'>
  <head>
    <meta charset='utf-8' />
    <title>H A L O</title>
    <meta name='viewport' content='width=device-width, initial-scale=1' />
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v2.5.0/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v2.5.0/mapbox-gl.css' rel='stylesheet' />
    <script src='https://npmcdn.com/@turf/turf/turf.min.js'></script>
    <style>
      body
      {
        margin: 0;
        padding: 0;
      }
      #map {
        position: absolute;
        top: 0;
        bottom: 0;
        width: 100%;
      }
      .mapboxgl-popup {
        width: 360px;

      }
      .mapboxgl-popup-content {
        text-align: right;
        font-family: 'Open Sans', sans-serif;
      }

    </style>
  </head>

  <body>
    <div id='map'></div>

    <script>
    // The 2nd DIV is for the elevation info to be shown
    mapboxgl.accessToken = 'pk.eyJ1IjoidGhlaGFsb3RlYW0iLCJhIjoiY2ttcDB2YjdrMDdmZjJxcW0xMG10b3VjZSJ9.bRVI_7ubNYtwMXX5qAGxVA';
    const map = new mapboxgl.Map({
      container: 'map',
      // Replace YOUR_STYLE_URL with your style URL.
      style: 'mapbox://styles/thehaloteam/ckuahpkzl5eyp17s7mml1gq8n',
      center: [-82.2745, 28.3361],
      zoom: 10.0
    });




// Create constants for the latitude and longitude
    let lng;
    let lat;

  map.on('click', ({ lngLat }) => {
/* When the map is clicked, set the lng and
lat constants equal to the lng and lat properties in the returned lngLat object*/
    lng = lngLat.lng;
    lat = lngLat.lat;
    console.log("lng:",`${lng},lat: ${lat}`);
      const lngDisplay = document.getElementById('lng');
      const latDisplay = document.getElementById('lat');
      const eleDisplay = document.getElementById('ele');
});



    /*  Add an event listener that runs when a user clicks on the map element. */
    map.on('click', ({ point }) => {
      // If the user clicked on one of your markers, get its information.
      const features = map.queryRenderedFeatures(point, {
    layers: ['san-antonio']
      });
      if (!features.length) {
      return;
      }
      console.log(`${map.queryRenderedFeatures}`);
      const feature = features[0];
      const popup = new mapboxgl.Popup({ offset: [0, -15] })
          .setLngLat(feature.geometry.coordinates)
          .setHTML(
          `
          <h4>${feature.properties.OWNER_NAME_1}</h4>
          <hr>${feature.properties.ADDRESS}</hr>
          <br> Year Built  : ${feature.properties.EFFECTIVE_YEAR_BUILT}
          <br> Has Pool? : ${feature.properties.HAS_POOL}
          <br> SQFT : ${feature.properties.LIVING_AREA}
          <br> Homestead : ${feature.properties.HAS_HOMESTEAD}
          <br> Last Sold : ${feature.properties.SALE_DATE}
          <br> Property Type : ${feature.properties.LAND_USE_DESC}
          <hr>
          `
        )
        .addTo(map);
    });


    async function getElevation() {
    // Construct the API request
    const query = await fetch(
    `https://api.mapbox.com/v4/mapbox.mapbox-terrain-v2/tilequery/${lng},${lat}.json?layers=contour&limit=50&access_token=${mapboxgl.accessToken}`,
    { method: 'GET' }
    );
    if (query.status !== 200) return;
    const data = await query.json();
    // Display the longitude and latitude values
    lngDisplay.textContent = lng.toFixed(2);
    latDisplay.textContent = lat.toFixed(2);
    // Get all the returned features
    const allFeatures = data.features;
    // For each returned feature, add elevation data to the elevations array
    const elevations = allFeatures.map((feature) => feature.properties.ele);
    // In the elevations array, find the largest value
    const highestElevation = Math.max(...elevations);
    // Display the largest elevation value
    eleDisplay.textContent = `${highestElevation} meters`;
    }



    map.on('load', () => {
    map.addSource('earthquakes', {
    type: 'geojson',
    // Use a URL for the value for the `data` property.
    data: 'https://docs.mapbox.com/mapbox-gl-js/assets/earthquakes.geojson'
    });


    map.addLayer({
    'id': 'earthquakes-layer',
    'type': 'circle',
    'source': 'earthquakes',
    'paint': {
    'circle-radius': 8,
    'circle-stroke-width': 2,
    'circle-color': 'red',
    'circle-stroke-color': 'white'
    }
    });
    });


    </script>
  </body>
</html>
